<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Neko BTC — Mint</title>
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32.png') }}">
  <!-- Kawaii display + rounded JP font -->
  <link href="https://fonts.googleapis.com/css2?family=Rampart+One&family=Zen+Maru+Gothic:wght@500;700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg-pink: #ff66a3;
      --bg-pink-deep: #ff4d95;
      --neon-teal: #7efcff;
      --lav: #d9b3ff;
      --ink: #0b1020;
      --chip: #111832;
      --chip-2: #0d1430;
      --white: #fff;
      --soft: rgba(255, 255, 255, .75);
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      background:
        radial-gradient(60vmax 60vmax at 20% 15%, #ffd3e8 0%, transparent 60%),
        radial-gradient(70vmax 70vmax at 80% 80%, #ffc2ea 0%, transparent 55%),
        linear-gradient(140deg, var(--bg-pink) 0%, var(--bg-pink-deep) 60%, #ff2e85 100%);
      color: var(--white);
      display: grid;
      place-items: center;
      min-height: 100svh;
      overflow-x: hidden;
      font-family: "Zen Maru Gothic", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial;
      letter-spacing: .2px;
    }

    .container {
      text-align: center;
      width: min(92vw, 760px);
      position: relative;
      z-index: 1;
    }

    header h1 {
      font-family: "Rampart One", system-ui;
      margin: 18px 0 6px;
      font-size: clamp(32px, 6vw, 64px);
      line-height: 1.05;
      letter-spacing: .5px;
      background: linear-gradient(90deg, var(--neon-teal), var(--lav), var(--white));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      -webkit-text-stroke: 1px rgba(10, 15, 35, .6);
      text-shadow: 0 0 1px rgba(0, 0, 0, .4), 0 2px 12px rgba(126, 252, 255, .4), 0 0 40px rgba(217, 179, 255, .18);
    }

    header .tag {
      font-size: clamp(12px, 2.8vw, 16px);
      margin-top: 4px;
      color: rgba(255, 255, 255, .9);
      display: inline-flex;
      align-items: center;
      gap: .5ch;
      padding: 6px 12px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255, 255, 255, .08), rgba(255, 255, 255, .03));
      border: 1px solid rgba(255, 255, 255, .18);
      box-shadow: 0 6px 24px rgba(0, 0, 0, .18), inset 0 1px 0 rgba(255, 255, 255, .15);
      backdrop-filter: blur(6px);
    }

    .counter {
      margin-top: 10px;
      font-weight: 700;
      font-size: clamp(14px, 3.2vw, 18px);
      color: var(--neon-teal);
      text-shadow: 0 0 12px rgba(126, 252, 255, .55);
    }

    .visit-link {
      margin-top: 14px;
      padding: 14px 22px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 16px;
      letter-spacing: .4px;
      cursor: pointer;
      color: #0a1328;
      background: linear-gradient(180deg, #c8fff8, #9ef4f1);
      border: 1px solid #8ee8e5;
      box-shadow: 0 8px 24px rgba(0, 0, 0, .22), 0 0 0 4px rgba(126, 252, 255, .18), inset 0 1px 0 rgba(255, 255, 255, .8);
      transition: transform .08s ease, filter .15s ease, box-shadow .2s ease;
      display: inline-block;
      text-decoration: none;
    }

    .visit-link:hover {
      transform: translateY(-1px);
      filter: brightness(1.03);
    }

    .visit-link:active {
      transform: translateY(0);
      filter: brightness(.98);
    }

    .image-wrap {
      margin: 20px auto 10px;
      width: 340px;
      height: 340px;
      max-width: 90vw;
      max-height: 90vw;
      padding: 10px;
      border-radius: 28px;
      background: linear-gradient(180deg, rgba(255, 255, 255, .25), rgba(255, 255, 255, .05));
      border: 1px solid rgba(255, 255, 255, .22);
      box-shadow: 0 10px 30px rgba(0, 0, 0, .25), 0 0 0 6px rgba(126, 252, 255, .08), 0 0 40px rgba(217, 179, 255, .18);
      backdrop-filter: blur(6px);
    }

    .image-container {
      position: relative;
      display: grid;
      place-items: center;
      overflow: hidden;
      width: 100%;
      height: 100%;
      border-radius: 20px;
      background: radial-gradient(120% 120% at 50% 0%, var(--chip) 0%, var(--chip-2) 60%, #0a0f26 100%);
      border: 1px solid rgba(126, 252, 255, .18);
      box-shadow: inset 0 8px 30px rgba(0, 0, 0, .45);
    }

    .image-container::after {
      content: "";
      position: absolute;
      inset: 8px;
      border-radius: 16px;
      border: 2px solid rgba(126, 252, 255, .15);
      pointer-events: none;
      box-shadow: inset 0 0 22px rgba(126, 252, 255, .15), inset 0 0 55px rgba(217, 179, 255, .08);
    }

    #randomImage {
      width: 100%;
      height: 100%;
      object-fit: contain;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      transition: opacity .5s ease, transform .25s ease;
      filter: drop-shadow(0 2px 0 rgba(255, 255, 255, .35)) drop-shadow(0 0 18px rgba(126, 252, 255, .25));
    }

    .loaded {
      opacity: 1;
      transform: scale(1);
    }

    #randomImage:not(.loaded) {
      opacity: 0;
      transform: scale(.985);
    }

    .flyer-container {
      position: fixed;
      inset: 0;
      overflow: hidden;
      z-index: 0;
      pointer-events: none;
    }

    .flyer {
      position: absolute;
      width: 128px;
      height: 128px;
      object-fit: contain;
      image-rendering: pixelated;
      animation: flyAcross 12s linear infinite;
      opacity: .7;
      filter: drop-shadow(0 0 12px rgba(255, 255, 255, .18));
    }

    @keyframes flyAcross {
      0% {
        transform: translateX(-140px) translateY(var(--y, 0px)) rotate(0deg);
      }

      100% {
        transform: translateX(calc(100vw + 140px)) translateY(var(--y, 0px)) rotate(360deg);
      }
    }

    .subtagline {
      margin-top: 8px;
      font-size: clamp(12px, 2.6vw, 15px);
      color: rgba(255, 255, 255, .88);
      text-shadow: 0 0 10px rgba(217, 179, 255, .22);
      letter-spacing: .4px;
    }
  </style>
</head>

<body>
  <div class="flyer-container" id="flyerContainer"></div>
  <div class="container">
    <header>
      <h1>ねNEKOこ ねNEKOこ</h1>
      <div class="tag">ねこねこ · Mint Page</div>
      <div class="subtagline">Kawaii Bitcoin inscriptions — one purr at a time</div>
      <div class="counter">SOLD OUT</div>
    </header>
    <div>
      <a href="https://x.com/nekonekobtc" class="visit-link" target="_blank" rel="noopener noreferrer">VISIT US ON X</a>
    </div>
    <div class="image-wrap">
      <div class="image-container">
        <img id="randomImage" src="" alt="Neko">
      </div>
    </div>
  </div>
  <script>
    // ===== Global state =====
    let slideshowTimer = null;
    const SLIDESHOW_MS = 5000;
    const $id = (x) => document.getElementById(x);

    // ===== Slideshow =====
    function fadeSwapImage(newUrl) {
      const img = $id('randomImage');
      img.classList.remove('loaded');
      const onLoad = () => { img.classList.add('loaded'); img.removeEventListener('load', onLoad); };
      img.addEventListener('load', onLoad);
      img.crossOrigin = 'anonymous';
      img.src = newUrl;
    }
    async function slideshowTick() {
      try {
        const res = await fetch('/randomize_preview', { method: 'GET', cache: 'no-store' });
        if (!res.ok) return;
        const response = await res.json();
        if (response.imageUrl) fadeSwapImage(response.imageUrl);
      } catch (_) { /* silent */ }
    }
    function startSlideshow() {
      if (slideshowTimer) clearInterval(slideshowTimer);
      slideshowTimer = setInterval(slideshowTick, SLIDESHOW_MS);
      slideshowTick();
    }

    // ===== Pixel flyers =====
    async function createFlyers() {
      const container = $id('flyerContainer');
      const images = Array.from({ length: 8 }, (_, i) => `static/flyers/${i + 1}.png`);
      const scaleFactor = 4;
      for (const src of images) {
        try {
          const img = new Image();
          img.src = src;
          img.crossOrigin = 'anonymous';
          await new Promise((resolve, reject) => {
            img.onload = resolve;
            img.onerror = () => reject(new Error('Failed to load ' + src));
          });
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = 32 * scaleFactor; canvas.height = 32 * scaleFactor;
          ctx.imageSmoothingEnabled = false;
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          const flyerImg = document.createElement('img');
          flyerImg.src = canvas.toDataURL('image/png');
          flyerImg.className = 'flyer';
          flyerImg.style.top = `${Math.random() * (window.innerHeight - 120)}px`;
          flyerImg.style.setProperty('--y', `${(Math.random() * 40 - 20)}px`);
          flyerImg.style.animationDelay = `${Math.random() * 12}s`;
          container.appendChild(flyerImg);
        } catch (err) { console.error(err); }
      }
    }

    // ===== Init =====
    document.addEventListener('DOMContentLoaded', () => {
      startSlideshow();
      createFlyers();
    });
  </script>
</body>

</html>