<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Payment Form</title>
</head>
<body>
    <h1>Bitcoin Payment Form</h1>
    <form id="paymentForm">
        <label for="receiveAddress">Receive Address:</label>
        <input type="text" id="receiveAddress" placeholder="Enter receive address" required><br>

        <label for="feeRate">Fee Rate (sat/vByte):</label>
        <input type="number" id="feeRate" min="1" max="100" value="6"><br>

        <label for="outputValue">Output Value:</label>
        <input type="number" id="outputValue" value="546" readonly><br>

        <label for="imageInput">Image:</label>
        <input type="file" id="imageInput"><br>

        <button type="button" id="submitButton">Submit</button>
    </form>

    <div id="result"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const submitButton = document.getElementById('submitButton');
            const resultDiv = document.getElementById('result');

            submitButton.addEventListener('click', function () {
                const receiveAddress = document.getElementById('receiveAddress').value;
                const feeRate = parseInt(document.getElementById('feeRate').value);
                const outputValue = parseInt(document.getElementById('outputValue').value);

                const imageInput = document.getElementById('imageInput');
                const imageFile = imageInput.files[0];

                if (!receiveAddress || !feeRate || !outputValue || !imageFile) {
                    alert('Please fill in all fields and select an image.');
                    return;
                }

                // Encode the image to base64
                const reader = new FileReader();
                reader.onload = function () {
                    const base64Image = reader.result;

                    // Create the payload object
                    const payload = {
                        receiveAddress,
                        feeRate,
                        outputValue,
                        files: [
                            {
                                filename: "my_image.png",
                                dataURL: base64Image,
                            },
                        ],
                        devAddress: "bc1pra6pu30zu5ux72fs0jryh2ykt2zdqkcc2t7n98rrjpy70mnm3fcsxgd9xy",
                        devFee: 10600
                    };

                    // Display the payload result on the page
                    resultDiv.innerText = JSON.stringify(payload, null, 2);

                    // Make the API request with fetch
                    const apiKey = '0c3bf50981aa4abd0dfd0b52315fdf527ab72750a527cb418bd21a649b825397';
                    const apiUrl = 'https://open-api.unisat.io/v2/inscribe/order/create';
                    const headers = {
                        "Authorization": `Bearer ${apiKey}`,
                        "Content-Type": "application/json"
                    };

                    fetch(apiUrl, {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify(payload),
                    })
                    .then((response) => response.json())
                    .then((data) => {
                        // Handle the response from the server here
                        resultDiv.innerText += '\n\nResponse from Server:\n' + JSON.stringify(data, null, 2);
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                    });
                };

                reader.readAsDataURL(imageFile);
            });
        });
    </script>
</body>
</html>
